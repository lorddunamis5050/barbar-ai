generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Booking {
  id            String        @id @default(cuid())
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  status        BookingStatus @default(PENDING)
  customerName  String
  customerPhone String
  customerEmail String?
  serviceName   String
  startAt       DateTime
  endAt         DateTime
  barberName    String?
  googleEventId String?       @unique
  notes         String?

  @@index([startAt])
  @@index([customerPhone])
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  RESCHEDULED
  ESCALATED
}

model Conversation {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  channel   Channel  @default(CHAT)
  status    ConversationStatus @default(OPEN)

  // optional metadata
  customerName  String?
  customerPhone String?
  customerEmail String?

  messages  Message[]

  @@index([status])
  @@index([channel])
}

model Message {
  id             String   @id @default(cuid())
  createdAt      DateTime @default(now())

  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  role           MessageRole
  content        String

  @@index([conversationId, createdAt])
}

enum Channel {
  CHAT
  PHONE
}

enum ConversationStatus {
  OPEN
  ESCALATED
  CLOSED
}

enum MessageRole {
  USER
  AGENT
  SYSTEM
}
